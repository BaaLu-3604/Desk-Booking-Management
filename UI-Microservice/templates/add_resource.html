{% extends 'layout.html' %}

{% block title %}Add Resource{% endblock %}

{% block content %}
{% if 'username' in session %}
<div class="container-fluid col-8" style="margin-top: 6%">
    <div class="row justify-content-end">
        <div class="p-4 rounded-4" style="background-color: rgba(201, 197, 199, 0.705);
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(2px);">
            <form class="" method="post" >
                <div class="row mt-2">
                    <div class="col-md-3 mt-2">
                        <label for="selectBuilding" class="form-label  opacity-100 fw-bold">Building</label>
                        <select required id="selectBuilding" name="selectBuilding" class="form-select mb-3">
                            <option value="select">--Select Building--</option>
                            {% for building in resources_data %}
                            <option value="{{ building.name }}">{{ building.name }}</option>
                            {% endfor %}
                            <option value="Add Building">Add Building</option>
                        </select>
                    </div>
                    
                    <script>
                        // Get references to relevant elements
                        const selectBuilding = document.getElementById('selectBuilding');
                        const selectBlock = document.getElementById('selectBlock');

                        // Add an event listener to the select element
                        selectBuilding.addEventListener('change', function () {
                            if (selectBuilding.value === 'Add Building') {
                                // Replace the select element with an input field
                                const newBuildingInput = document.createElement('input');
                                newBuildingInput.type = 'text';
                                newBuildingInput.id = 'newBuildingName';
                                newBuildingInput.name = 'newBuildingName';
                                newBuildingInput.placeholder = 'Enter Building Name';
                                newBuildingInput.className = 'form-control mb-3';

                                // Replace the select element with the input field
                                selectBuilding.parentNode.replaceChild(newBuildingInput, selectBuilding);

                                // Focus on the input field
                                newBuildingInput.focus();
                                
                                // Replace the select element with an input field for Block
                                const newBlockInput = document.createElement('input');
                                newBlockInput.type = 'text';
                                newBlockInput.id = 'newBlockName';
                                newBlockInput.name = 'newBlockName';
                                newBlockInput.placeholder = 'Enter Block Name';
                                newBlockInput.className = 'form-control mb-3';

                                // Replace the select element with the input field
                                selectBlock.parentNode.replaceChild(newBlockInput, selectBlock);

                                // Focus on the input field
                                newBlockInput.focus();
                            }
                        });
                        const DeccanBlocks = ["DP A", "DP B", "DP C", "DP D"];
                        const SynergyBlocks = ["SP A", "SP B", "SP C"];
                        const KohinoorBlocks = ["KP A", "KP B", "KP C"];

                        // Function to BLOCKS select based on the selected BUILDINGS
                        function Blocks() {
                            const selectedBuilding = selectBuilding.value;
                            selectBlock.innerHTML = ''; // Clear the current block options
                            let BlocksSelection = [];

                            if (selectedBuilding === 'Deccan Park') {
                                BlocksSelection = DeccanBlocks;
                            } else if (selectedBuilding === 'Synergy Park') {
                                BlocksSelection = SynergyBlocks;
                            } else if (selectedBuilding === 'Kohinoor Park') {
                                BlocksSelection = KohinoorBlocks;
                            }

                            // Add the new block options
                            BlocksSelection.forEach(block => {
                                const option = document.createElement('option');
                                option.value = block;
                                option.textContent = block;
                                selectBlock.appendChild(option);
                            });
                        }

                        // Add an event listener to the selectBuilding element
                        selectBuilding.addEventListener('change', Blocks);
                        
                        // Initially populate the selectBlock with default options
                        Blocks();
                    </script>

                    <div class="col-md-3 mt-2">
                        <label for="selectBlock" class="form-label  fw-bold">Block</label>
                        <select required id="selectBlock" name="selectBlock" class="form-select mb-3">
                            <option value="--Select Block--">--Select Block--</option>    
                           
                        </select>
                    </div>                   
                    <div class="col-md-3 mt-2">
                    <label for="deskNo" class="form-label fw-bold">Desk No</label>
                        <input type="number" required id="DeskNo" name="DeskNo" class="form-control">  
                </div>

                <div class="col-md-3 mt-2">
                    <label for="deskNo" class="form-label  fw-bold">Resources</label>
                    <input type="text" class="form-control mb-3" id="resources" name="resources"
                        placeholder="Enter Resources" required>
                </div>

                <div class="d-flex mt-4  justify-content-center">
                    <input type="submit" class="btn fw-bold btn-primary" value="Add Resource">
                </div>
            </div>
            </div>
            <p class="text-center mt-3" style="color: tomato;">{{error}}</p>
        </form>
    </div>
    {% for building in buildings %}
                        <option value="{{ building.name }}">{{ building.name }}</option>
                    {% endfor %}
    <div class="container mt-3">
        <table class="table table-dark table-hover">
            <thead>
                <tr>
                    <th>Building</th>
                    <th>Blocks</th>
                    <th>Desks</th>
                </tr>
            </thead>
            <tbody>
                {% for resources in resources_data %}
                <tr>
                    <td>{{ resources.name }}</td>
                    <td>{{ resources.name }}</td>
                    <td>{{ resources.name }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
</div>
</div>
{% else %}
<div class="p-3 w-25 offset-5 my-5 rounded-3 fw-bold bg-danger text-white">
    <p>Session Expired Please Login ..!</p>
</div>
{% endif %}
{% endblock %}